<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   
    "-//mybatis.org//DTD Mapper 3.0//EN"  
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dao.CartDao">
	
	<insert id="addGoods">
		insert into cart_goods(cart_id,g_id,count,amount) values(1,#{g.id},#{num},#{num}*#{g.price}) 
	</insert>
	<delete id="deleteGoods">
		delete from cart_goods where g_id=#{g.id}
	</delete>
	<update id="increaseGoods">
		update cart_goods set count=count+#{num},amount=#{g.price}*count where g_id=#{g.id}
	</update>
	<select id="searchAll" resultMap="CartAndGoods">
		select * from cart
	</select>
	<select id="searchGoodsById" resultType="entity.Goods">
		select g.*,m.count
		from shopping_cart as c
		inner join cart_goods as m
		on c.id=m.cart_id
		inner join goods as g
		on m.g_id=g.id
		where g.id=#{id}
	</select>
	<resultMap type="entity.Cart" id="CartAndGoods">
		<id property="id" column="id"/>
		<result property="l_amount" column="l_amount"/>
		<result property="count" column="count"/>
		<association property="goods" javaType="entity.Goods" column="g_id" select="dao.CartDao.searchGoodsById">
		</association>
	</resultMap>
</mapper> 
    